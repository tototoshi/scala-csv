name: Release

on:
  push:
    tags:
      - '*.*.*'

jobs:
  releases:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
    - uses: actions/checkout@v6
    - uses: actions/setup-java@dded0888837ed1f317902acf8a20df0ad188d165 # v5.0.0
      with:
        java-version: 8
        distribution: adopt
    - uses: coursier/cache-action@v7
    - name: Setup GPG
      run: |
        echo "$GPG_PRIVATE_KEY" | gpg --batch --import
      env:
        GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}

    - name: Publish to Sonatype
      env:
        SONATYPE_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
        SONATYPE_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
        PGP_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
      run: sbt clean +test +publishSigned sonaRelease
